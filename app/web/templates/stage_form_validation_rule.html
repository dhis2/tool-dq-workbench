{% extends "layout.html" %}

{% block title %}{{ 'Edit' if edit else 'Create' }} Validation Rule Stage{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='tomselect/tom-select.bootstrap5.min.css') }}">
<script src="{{ url_for('static', filename='tomselect/tom-select.complete.js') }}"></script>
{% include "partials/tom_select_dataelement.html" %}
{% include "partials/tom_select_vrg.html" %}
{% endblock %}

{% block content %}
{% include "partials/_flashes.html" %}
<h1>{{ 'Edit' if edit else 'New' }} Validation Rule Stage</h1>

<form method="post">
    <div class="mb-3">
        <label class="form-label" for="stage_name">Stage Name</label>
        <input class="form-control" id="stage_name" name="stage_name" value="{{ stage.name }}" required>
    </div>

    <div class="mb-3">
        <label class="form-label" for="orgunit_level">Org Unit Level</label>
        <input class="form-control" id="orgunit_level" name="orgunit_level" type="number" value="{{ stage.level }}"
               required>
    </div>

    <div class="mb-3">
        <label class="form-label" for="duration">Duration (e.g. 12 months)</label>
        <input class="form-control" id="duration" name="duration" value="{{ stage.duration }}" required>
    </div>

    <div class="mb-3">
        <label class="form-label" for="validation_rule_group">Validation Rule Group</label>
        <select id="validation_rule_group" name="validation_rule_group" placeholder="Search..." class="form-select">
            {% if stage.params.validation_rule_group %}
            <option value="{{ stage.params.validation_rule_group }}" selected>
                {{ validation_rule_group_name or stage.params.validation_rule_group }}
            </option>
            {% endif %}
        </select>
    </div>

    <div class="mb-3">
        <label class="form-label" for="period_type">Period Type</label>
        <select class="form-select" id="period_type" name="period_type" required>
            {% for pt in period_types %}
            <option value="{{ pt }}" {% if stage.params.period_type== pt %}selected{% endif %}>
                {{ pt.title() }}
            </option>
            {% endfor %}
        </select>
    </div>
    <div class="mb-3">
        <label class="form-label" for="destination_data_element">Destination Data Element</label>
        <select id="destination_data_element" name="destination_data_element" placeholder="Search..."
                class="form-select">
            {% if stage.params.destination_data_element %}
            <option value="{{ stage.params.destination_data_element }}" selected>
                {{ data_element_name or stage.params.destination_data_element }}
            </option>
            {% endif %}
        </select>
    </div>
    <div class="mb-3">
        <input class="form-check-input" type="checkbox" id="active" name="active" {% if stage.active %}checked{% endif
               %}>
        <label class="form-check-label" for="active">Active</label>
    </div>
    <button class="btn btn-primary" type="submit">{{ 'Update' if edit else 'Create' }} Stage</button>
    <a class="btn btn-secondary" href="{{ url_for('ui.index') }}">Cancel</a>
</form>
{% endblock %}