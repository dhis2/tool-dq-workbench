<script>
  document.addEventListener("DOMContentLoaded", function () {
  new TomSelect("#dataset", {
    valueField: "id",
    labelField: "text",
    searchField: "text",
    load: function(query, callback) {
      if (query.length < 3) return callback();
      fetch(`/api/datasets?q=${encodeURIComponent(query)}`)
        .then(response => response.json())
        .then(callback)
        .catch(() => callback());
    },
    preload: true,
    {% if stage.params.dataset %}
    items: ["{{ stage.params.dataset }}"],
    {% endif %}
  });
    });
</script>